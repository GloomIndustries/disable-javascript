'use strict';var browser=browser,promises=!0;function domContentLoaded(){var i=[{label:'Default state',name:'default_state',type:'radio',options:[{label:'JS on',value:'on'},{label:'JS off',value:'off'}]},{label:'Disable behavior',name:'disable_behavior',type:'radio',options:[{label:'By domain',value:'domain'},{label:'By tab',value:'tab'}]},{label:'Enable shortcuts',name:'shortcuts',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]},{label:'Enable context menu item',name:'context_menu',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]}],m='setting-',t=document.getElementById('add-domain-form-modal'),e=document.getElementById('add-domain-form'),o=document.getElementById('add-domain-form__domain-name'),a=document.getElementById('add-domain-form-modal__close'),n=document.getElementById('add-domain-form__include-sub-domains'),d=' <span class="version">(v'+browser.runtime.getManifest().version+')</span>';function l(e){var a=document.getElementById('domain-list--tbody'),t='',o=!1,n=[],d=document.getElementById('search');for(var l in e)l.startsWith(m)||(n.push(l),o=!0);for(var r=n.length-1;0<=r;r--){var s,i=!1;'string'==typeof e[l=n[r]]?s=new Date(e[l]):(s=new Date(e[l].date),i=e[l]['include-subdomains']),t+='<tr>',t+='<td>'+l+'</td>',t+='<td>'+s.toLocaleDateString()+' '+s.toLocaleTimeString()+'</td>',t+='<td>'+(i?'Yes':'No')+'</td>',t+='</tr>'}0===t.length?(t+='<tr>',t+='<td class="empty" colspan="3">You have not added any domains to your white-/blacklist yet.</td>',t+='</tr>',d.disabled=!0):d.disabled=!1,a.innerHTML=t;var c=a.querySelectorAll('tr');for(r=0;r<c.length;r++)c[r].addEventListener('click',function(){if(this.classList.contains('active'))this.classList.remove('active');else{for(var e=a.querySelectorAll('tr.active'),t=0;t<e.length;t++)e[t].classList.remove('active');this.classList.add('active'),document.getElementById('remove').disabled=!1}});o&&(document.getElementById('remove-all').disabled=!1)}function r(e){'domain'===e[m+'disable_behavior']?(document.body.classList.remove('disable-behavior--tab'),promises?browser.storage.local.get().then(l):browser.storage.local.get(l)):document.body.classList.add('disable-behavior--tab')}function s(){document.getElementById('remove').disabled=!0,document.getElementById('remove-all').disabled=!0,promises?browser.storage.local.get(m+'disable_behavior').then(r):browser.storage.local.get(m+'disable_behavior',r)}function c(){t.style.display='none'}function u(){var e={},t=this.value;switch(this.value){case'true':t=!0;break;case'false':t=!1}e[m+this.name]=t,browser.storage.local.set(e),browser.runtime.sendMessage({type:this.name,value:t}),s()}function v(e){for(var t='',a=0;a<i.length;a++){var o=i[a];t+='<tr>',t+='<td><label>'+o.label+'</label></td>',t+='<td>';for(var n=0;n<i[a].options.length;n++){var d=o.options[n],l=o.name+'-'+d.value,r='';e[m+o.name]===d.value?r=' checked="checked"':!0===e[m+o.name]&&'true'===d.value?r=' checked="checked"':!1===e[m+o.name]&&'false'===d.value&&(r=' checked="checked"'),t+='<input type="'+o.type+'" name="'+o.name+'" id="'+l+'" value="'+d.value+'"'+r+' />',t+='<label for="'+l+'">'+d.label+'</label>'}t+='</td>',t+='</tr>'}document.getElementById('settings').innerHTML=t;var s=document.querySelectorAll('input[type=radio]');for(a=0;a<s.length;a++)s[a].addEventListener('click',u)}for(var b=document.querySelectorAll('input[type=button]'),f=0;f<b.length;f++)switch(b[f].id){case'remove':case'remove-all':b[f].disabled=!0}!function(){for(var e=[],t=0;t<i.length;t++)e.push(m+i[t].name);promises?browser.storage.local.get(e).then(v):browser.storage.local.get(e,v)}(),s(),document.getElementById('remove').addEventListener('click',function(){for(var e=document.querySelectorAll('#domain-list--tbody tr.active'),t=0;t<e.length;t++){var a=e[t].childNodes[0].innerHTML;promises?browser.storage.local.remove(a).then(s):browser.storage.local.remove(a,s)}}),document.getElementById('remove-all').addEventListener('click',function(){if(confirm('Are you sure to clear your domain list?')){for(var e={},t=0;t<i.length;t++){var a=i[t].name,o=document.querySelector('input[name="'+a+'"]:checked').value;e[m+a]=o}var n=browser.runtime.getManifest();e['setting-version']=n.version,promises?browser.storage.local.clear().then(function(){browser.storage.local.set(e).then(function(){s()})}):browser.storage.local.clear(function(){browser.storage.local.set(e,function(){s()})})}}),document.getElementById('add-domain').addEventListener('click',function(){e.reset(),t.style.display='block',o.focus()}),e.addEventListener('submit',function(e){e.preventDefault();var t=o.value;if(!/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(t))return o.setCustomValidity('Please enter a valid host'),!1;var a={};return a[t]={date:(new Date).toISOString()},n.checked&&(a[t]['include-subdomains']=!0),promises?browser.storage.local.set(a).then(function(){s(),c()}):browser.storage.local.set(a,function(){s(),c()}),!1}),o.addEventListener('change',function(){this.setCustomValidity('')}),a.addEventListener('click',c),document.getElementById('search').value='',document.getElementById('search').addEventListener('keyup',function(){for(var e=document.getElementById('domain-list--tbody').getElementsByTagName('tr'),t=0;t<e.length;t++){var a=e[t].getElementsByTagName('td')[0];a&&(-1<a.innerHTML.toUpperCase().indexOf(this.value.toUpperCase())?e[t].style.display='':e[t].style.display='none')}}),window.addEventListener('click',function(e){void 0!==e&&e.target===t&&c()}),document.getElementById('page-title').innerHTML+=d}void 0===browser&&(browser=chrome,promises=!1),document.addEventListener('DOMContentLoaded',domContentLoaded);