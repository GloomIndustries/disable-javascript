'use strict';var browser=browser,promises=!0;void 0===browser&&(browser=chrome,promises=!1);function domContentLoaded(){var e=[{label:'Default state',name:'default_state',type:'radio',options:[{label:'JS on',value:'on'},{label:'JS off',value:'off'}]},{label:'Disable behavior',name:'disable_behavior',type:'radio',options:[{label:'By domain',value:'domain'},{label:'By tab',value:'tab'}]},{label:'Enable shortcuts',name:'shortcuts',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]},{label:'Enable context menu item',name:'context_menu',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]}],t='setting-',a=document.getElementById('add-domain-form-modal'),o=document.getElementById('add-domain-form'),d=document.getElementById('add-domain-form__domain-name'),n=document.getElementById('add-domain-form-modal__close'),l=document.getElementById('add-domain-form__include-sub-domains');function r(e){var a=document.getElementById('domain-list--tbody'),o='',d=!1,n=[],l=document.getElementById('search');for(var r in e)r.startsWith(t)||(n.push(r),d=!0);for(var s=n.length-1;s>=0;s--){var i,c=!1;'string'==typeof e[r=n[s]]?i=new Date(e[r]):(i=new Date(e[r].date),c=e[r]['include-subdomains']),o+='<tr>',o+='<td>'+r+'</td>',o+='<td>'+i.toLocaleDateString()+' '+i.toLocaleTimeString()+'</td>',o+='<td>'+(c?'Yes':'No')+'</td>',o+='</tr>'}0===o.length?(o+='<tr>',o+='<td class="empty" colspan="3">You have not added any domains to your white-/blacklist yet.</td>',o+='</tr>',l.disabled=!0):l.disabled=!1,a.innerHTML=o;var m=a.querySelectorAll('tr');for(s=0;s<m.length;s++)m[s].addEventListener('click',function(){if(this.classList.contains('active'))this.classList.remove('active');else{for(var e=a.querySelectorAll('tr.active'),t=0;t<e.length;t++)e[t].classList.remove('active');this.classList.add('active'),document.getElementById('remove').disabled=!1}});d&&(document.getElementById('remove-all').disabled=!1)}function s(e){'domain'===e[t+'disable_behavior']?(document.body.classList.remove('disable-behavior--tab'),promises?browser.storage.local.get().then(r):browser.storage.local.get(r)):document.body.classList.add('disable-behavior--tab')}function i(){document.getElementById('remove').disabled=!0,document.getElementById('remove-all').disabled=!0,promises?browser.storage.local.get(t+'disable_behavior').then(s):browser.storage.local.get(t+'disable_behavior',s)}function c(){a.style.display='none'}function m(){var e={},a=this.value;switch(this.value){case'true':a=!0;break;case'false':a=!1}e[t+this.name]=a,browser.storage.local.set(e),browser.runtime.sendMessage({type:this.name,value:a}),i()}function u(a){for(var o='',d=0;d<e.length;d++){var n=e[d];o+='<tr>',o+='<td><label>'+n.label+'</label></td>',o+='<td>';for(var l=0;l<e[d].options.length;l++){var r=n.options[l],s=n.name+'-'+r.value,i='';a[t+n.name]===r.value?i=' checked="checked"':!0===a[t+n.name]&&'true'===r.value?i=' checked="checked"':!1===a[t+n.name]&&'false'===r.value&&(i=' checked="checked"'),o+='<input type="'+n.type+'" name="'+n.name+'" id="'+s+'" value="'+r.value+'"'+i+' />',o+='<label for="'+s+'">'+r.label+'</label>'}o+='</td>',o+='</tr>'}document.getElementById('settings').innerHTML=o;var c=document.querySelectorAll('input[type=radio]');for(d=0;d<c.length;d++)c[d].addEventListener('click',m)}for(var v=document.querySelectorAll('input[type=button]'),b=0;b<v.length;b++)switch(v[b].id){case'remove':case'remove-all':v[b].disabled=!0}!function(){for(var a=[],o=0;o<e.length;o++)a.push(t+e[o].name);promises?browser.storage.local.get(a).then(u):browser.storage.local.get(a,u)}(),i(),document.getElementById('remove').addEventListener('click',function(){for(var e=document.querySelectorAll('#domain-list--tbody tr.active'),t=0;t<e.length;t++){var a=e[t].childNodes[0].innerHTML;promises?browser.storage.local.remove(a).then(i):browser.storage.local.remove(a,i)}}),document.getElementById('remove-all').addEventListener('click',function(){if(confirm('Are you sure to clear your domain list?')){for(var a={},o=0;o<e.length;o++){var d=e[o].name,n=document.querySelector('input[name="'+d+'"]:checked').value;a[t+d]=n}var l=browser.runtime.getManifest();a['setting-version']=l.version,promises?browser.storage.local.clear().then(function(){browser.storage.local.set(a).then(function(){i()})}):browser.storage.local.clear(function(){browser.storage.local.set(a,function(){i()})})}}),document.getElementById('add-domain').addEventListener('click',function(){o.reset(),a.style.display='block',d.focus()}),o.addEventListener('submit',function(e){e.preventDefault();var t,a=d.value;if(t=a,!/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(t))return d.setCustomValidity('Please enter a valid host'),!1;var o={};return o[a]={date:(new Date).toISOString()},l.checked&&(o[a]['include-subdomains']=!0),promises?browser.storage.local.set(o).then(function(){i(),c()}):browser.storage.local.set(o,function(){i(),c()}),!1}),d.addEventListener('change',function(){this.setCustomValidity('')}),n.addEventListener('click',c),document.getElementById('search').value='',document.getElementById('search').addEventListener('keyup',function(){for(var e=document.getElementById('domain-list--tbody').getElementsByTagName('tr'),t=0;t<e.length;t++){var a=e[t].getElementsByTagName('td')[0];a&&(a.innerHTML.toUpperCase().indexOf(this.value.toUpperCase())>-1?e[t].style.display='':e[t].style.display='none')}}),window.addEventListener('click',function(e){void 0!==e&&e.target===a&&c()})}document.addEventListener('DOMContentLoaded',domContentLoaded);